<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eveline & Ernst</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* CSS is hierin opgenomen */
        
        /* AANGEPAAST LETTERTYPE */
        @font-face {
            font-family: 'Erno2024';
            src: url('../css/Erno2024.woff2') format('woff2'),
                 url('../css/Erno2024.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /* NIEUW LETTERTYPE: Eveline2024 */
        @font-face {
            font-family: 'Eveline2024';
            src: url('../css/Eveline2024.woff2') format('woff2'),
                 url('../css/Eveline2024.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /* GLOBALE STIJL & ACHTERGROND */
        body {
            font-family: 'Erno2024', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 10px;
            /* background.png als pagina-achtergrond */
            background-image: url('background.png');
            background-size: cover; 
            background-attachment: fixed; 
            background-color: #eee; /* Lichtere fallback kleur */
            
            color: #fff;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* Overlay om de achtergrondafbeelding lichter/vager te maken */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Alpha-waarde op 0.9 voor witter/vager effect */
            background-color: rgba(255, 255, 255, 0.9); 
            z-index: -1; 
        }

        h1 {
            /* Ongeveer 50% groter */
            font-size: 2.5em; 
            /* Kleur donkerblauw */
            color: #8f0000; 
            text-align: center;
            margin: 10px 0;
        }

        /* RESPONSIVITEIT & PUZZEL CONTAINER */
        #puzzle-container {
            width: 90vw; 
            max-width: 600px;
            height: 90vw; 
            max-height: 600px;
            display: grid;
            /* Rand donkerblauw */
            border: 5px solid #072f17; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            aspect-ratio: 1 / 1; 
        }

        /* Stijl voor elk tegelvakje */
        .tile {
            /* FIXED: Scale to full grid size, not individual tile */
            background-size: calc(var(--grid-size) * 100%) calc(var(--grid-size) * 100%); 
            cursor: pointer;
            transition: transform 0.3s, opacity 0.3s; 
            /* Rand donkerblauw */
            border: 1px solid #007a00; 
            box-sizing: border-box; 
        }

        /* De lege tegel is nu weer effen donker */
        .empty {
            background-image: none !important; 
            background-color: #ffffff; /* Donkere kleur */
            cursor: default;
        }
        
        /* GEDEELDE STIJL VOOR BOODSCHAP EN HOOGTE-RESERVERING */
        #message, #message-placeholder {
            /* Handhaaf 0 marge om de knoppen dichtbij te houden */
            margin-top: 0px; 
            /* Ongeveer 50% groter */
            font-size: 2.25em; 
            /* Kleur donkerblauw */
            color: hsl(0, 100%, 27%); 
            font-weight: bold;
            text-align: center;
            /* GECORRIGEERD: Gebruik Eveline2024 lettertype */
            font-family: 'Eveline2024', Arial, sans-serif; 
        }

        /* De eigenlijke boodschap begint onzichtbaar */
        #message {
            opacity: 0; /* Gebruik opacity voor een vloeiendere overgang */
            transition: opacity 0.5s ease-in-out;
        }

        /* De placeholder is de hele tijd zichtbaar om de hoogte te reserveren */
        #message-placeholder {
            visibility: hidden; /* Maakt het onzichtbaar maar behoudt de ruimte */
            min-height: 1em; /* Zorg voor minimale hoogte, zelfs met 1 spatie */
        }

        /* Knoppen container */
        #controls {
            margin-top: 15px;
            /* Handhaaf negatieve marge om de boodschap omhoog te trekken */
            margin-bottom: -10px; 
            display: flex;
            flex-wrap: wrap; 
            justify-content: center;
            gap: 10px;
        }
        
        #controls button {
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            /* Achtergrondkleur */
            background-color: #c8e6c9; 
            /* Tekstkleur */
            color: #800000; 
            /* AANPASSING 1: Dubbele rand */
            border: 2px solid #800000; 
            /* AANPASSING 2: Veel rondere hoeken voor speels effect */
            border-radius: 20px; 
            /* AANPASSING 3: Subtiele schaduw en box-shadow */
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.5); 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); /* Extra schaduw voor diepte */
            transition: transform 0.1s, box-shadow 0.1s;
            white-space: nowrap;
        }

        /* Nieuw: 'Ingeklikt' effect */
        #controls button:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        /* Specifieke stijl voor de 'Oplossing'-knop */
        #solve-button {
            /* Achtergrondkleur */
            background-color: #ffcdd2;
            /* Tekstkleur */
            color: #800000; 
        }
    </style>
</head>
<body>

    <h1>We wensen jullie fijne feestdagen...</h1>

    <div id="puzzle-container">
    </div>

    <div id="controls">
        <button id="shuffle-button">Opnieuw schudden!</button>
        <button id="difficulty-toggle">Dit is te makkelijk!</button> 
        <button id="solve-button">Help, ik kom er echt niet uit!</button>
    </div>

    <div id="message-placeholder">... en een jaar waarin alle stukjes op hun plek vallen!</div>
    <div id="message">... en een jaar waarin alle stukjes op hun plek vallen!</div>

    <script>
        // JavaScript is hierin opgenomen
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('puzzle-container');
            const message = document.getElementById('message');
            const placeholder = document.getElementById('message-placeholder'); 
            const shuffleButton = document.getElementById('shuffle-button');
            const solveButton = document.getElementById('solve-button');
            const difficultyToggle = document.getElementById('difficulty-toggle');
            
            let size = 3; 
            let tiles = []; 
            let currentBoard = []; 
            let emptyTileIndexInSolvedState = 0; 

            /**
             * Genereert de puzzeltegels.
             */
            function createTiles() {
                container.innerHTML = '';
                resetMessage(); 
                container.style.border = '5px solid #072f17'; 
                container.classList.remove('solved-background'); 
                const totalTiles = size * size;
                
                // Bepaal de index van de lege tegel in de opgeloste staat (rechtsboven)
                emptyTileIndexInSolvedState = size - 1; 

                container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
                container.style.gridTemplateRows = `repeat(${size}, 1fr)`;
                container.style.setProperty('--grid-size', size);

                tiles = [];
                for (let i = 0; i < totalTiles; i++) {
                    const tile = document.createElement('div');
                    tile.classList.add('tile');
                    tile.dataset.index = i;
                    
                    if (i !== emptyTileIndexInSolvedState) { 
                        const imageIndex = i; 
                        const row = Math.floor(imageIndex / size);
                        const col = imageIndex % size;
                        
                        // Use calc() to position based on grid fractions
                        const backgroundX = `calc(${col} * 100% / ${size - 1})`;
                        const backgroundY = `calc(${row} * 100% / ${size - 1})`;

                        tile.style.backgroundImage = `url('kerst.jpg')`; 
                        tile.style.backgroundPosition = `${backgroundX} ${backgroundY}`;
                        tile.addEventListener('click', handleTileClick);
                        
                    } else {
                        tile.classList.add('empty'); 
                    }
                    tiles.push(tile);
                }
                currentBoard = Array.from(tiles);
            }

            /**
             * Render de huidige tegels op het bord.
             */
            function renderTiles(array) {
                container.innerHTML = '';
                array.forEach(tile => container.appendChild(tile));
                currentBoard = Array.from(array);
            }
            
            /**
             * Controleert op oplosbaarheid.
             */
            function isSolvable(array) {
                let inversions = 0;
                const tileIndices = array
                    .filter(tile => !tile.classList.contains('empty'))
                    .map(tile => parseInt(tile.dataset.index));

                for (let i = 0; i < tileIndices.length; i++) {
                    for (let j = i + 1; j < tileIndices.length; j++) {
                        if (tileIndices[i] > tileIndices[j]) {
                            inversions++;
                        }
                    }
                }
                
                if (size % 2 !== 0) {
                    return inversions % 2 === 0;
                }
                return true; 
            }

            // Functie om de boodschap te resetten
            function resetMessage() {
                message.style.opacity = '0';
            }

            /**
             * Schuift de tegels.
             */
            function shuffle() {
                resetMessage(); 
                let shuffledTiles;
                
                do {
                    shuffledTiles = tiles.slice().sort(() => Math.random() - 0.5);
                } while (!isSolvable(shuffledTiles)); 

                renderTiles(shuffledTiles); 
            }

            /**
             * Schakelt de moeilijkheidsgraad tussen 3x3 en 4x4.
             */
            function toggleDifficulty() {
                if (size === 3) {
                    size = 4;
                    difficultyToggle.textContent = "Oei, ik heb mezelf overschat!";
                } else {
                    size = 3;
                    difficultyToggle.textContent = "Dit is te makkelijk!";
                }
                
                createTiles();
                shuffle();
            }
            
            /**
             * Maakt de puzzel direct opgelost ("Help"-knop).
             */
            function solvePuzzle() {
                renderTiles(tiles); 
                handleSolved();
            }

            function canMove(tileIndex, emptyIndex) {
                const tileRow = Math.floor(tileIndex / size);
                const tileCol = tileIndex % size;
                const emptyRow = Math.floor(emptyIndex / size);
                const emptyCol = emptyIndex % size;
                const sameRow = tileRow === emptyRow && Math.abs(tileCol - emptyCol) === 1;
                const sameCol = tileCol === emptyCol && Math.abs(tileRow - emptyRow) === 1;
                return sameRow || sameCol;
            }

            function swapTiles(index1, index2) {
                [currentBoard[index1], currentBoard[index2]] = [currentBoard[index2], currentBoard[index1]];
                renderTiles(currentBoard);
            }

            function handleTileClick(event) {
                const clickedTile = event.currentTarget;
                const tileIndex = currentBoard.indexOf(clickedTile);
                const emptyIndex = currentBoard.findIndex(tile => tile.classList.contains('empty'));
                if (canMove(tileIndex, emptyIndex)) {
                    swapTiles(tileIndex, emptyIndex);
                    if (isSolved()) {
                        handleSolved();
                    }
                }
            }

            /**
             * Controleert of de puzzel is opgelost (lege tegel rechtsboven).
             */
            function isSolved() {
                return currentBoard.every((tile, index) => {
                    if (tile.classList.contains('empty')) {
                        return index === emptyTileIndexInSolvedState; 
                    }
                    return parseInt(tile.dataset.index) === index;
                });
            }

            function handleSolved() {
                // Toon de boodschap
                message.style.opacity = '1';

                // Activeer confetti!
                const duration = 5 * 1000; 
                const animationEnd = Date.now() + duration;
                const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 99999, scalar: 1.5 }; 

                function randomInRange(min, max) {
                    return Math.random() * (max - min) + min;
                }
                
                // Laat de confetti van onderaf komen
                const interval = setInterval(function() {
                    const timeLeft = animationEnd - Date.now();

                    if (timeLeft <= 0) {
                        return clearInterval(interval);
                    }
                    
                    if (typeof confetti !== 'function') {
                        return clearInterval(interval);
                    }

                    const particleCount = 50 * (timeLeft / duration);

                    // Vuur van links
                    confetti(Object.assign({}, defaults, { 
                        particleCount: particleCount * 1.5, 
                        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                        spread: randomInRange(60, 90) 
                    }));

                    // Vuur van rechts
                    confetti(Object.assign({}, defaults, { 
                        particleCount: particleCount * 1.5, 
                        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                        spread: randomInRange(60, 90)
                    }));
                }, 250);

                container.style.border = '5px solid #072f17'; // Houd de rand
            }


            // --- Initialisatie & Knoppen ---
            
            placeholder.style.display = 'block'; 

            createTiles(); 
            shuffle(); 

            shuffleButton.addEventListener('click', shuffle);
            solveButton.addEventListener('click', solvePuzzle); 
            difficultyToggle.addEventListener('click', toggleDifficulty);
        });
    </script>
</body>
</html>